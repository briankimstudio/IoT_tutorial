<!DOCTYPE html>
<html>
<head>
  <title>MEOW Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', {'packages':['gauge','corechart']});
  </script>
</head>
<body>
  <h1>MEOW</h1>
  <p>System information</p>
  <div id="systeminformation">%SYSTEMINFORMATION%</div>
  <p>Sensor information</p>
  <div id="sensorreading">%SENSORS%</div>
 
<div id="chart_div"></div>
<div id="line_div"></div>

<script>
// google.charts.load('current', {'packages':['corechart','guage','line']});
google.charts.setOnLoadCallback(drawChart);

function drawChart() {
  var data = google.visualization.arrayToDataTable([
    ['Label', 'Value'],
    ['PM1.0', 0],
    ['PM2.5', 0],
    ['PM10', 0]
  ]);
  
  var options = {
    width: 400, height: 120,
    redFrom: 90, redTo: 100,
    yellowFrom:75, yellowTo: 90,
    minorTicks: 5
  };
  
  var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
  
  chart.draw(data, options);

  var data2 = new google.visualization.arrayToDataTable([
          ['Time', 'PM1.0', 'PM2.5', 'PM10'],
          ['0',0,0,0]
        ]);

  var options2 = {
    title: 'Ait Quaity',
    // curveType: 'function',
    legend: { position: 'bottom' }
  };

  var chart2 = new google.visualization.LineChart(document.getElementById('line_div'));
  chart2.draw(data2, options2);

  var n = 1;
  setInterval(function ( ) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        console.log(document.getElementById("sensorreading").innerHTML);
        document.getElementById("sensorreading").innerHTML = this.responseText;
        data.setValue(0, 1, document.getElementById("PM1.0").innerHTML);
        data.setValue(1, 1, document.getElementById("PM2.5").innerHTML);
        data.setValue(2, 1, document.getElementById("PM10").innerHTML);
        chart.draw(data, options);

        data2.addRows([[n.toString(), parseInt(document.getElementById("PM1.0").innerHTML),
        parseInt(document.getElementById("PM2.5").innerHTML),
        parseInt(document.getElementById("PM10").innerHTML)]]); 
        chart2.draw(data2, options2);
        n++;
      }
    };
    xhttp.open("GET", "/updatesensorreading", true);
    xhttp.send();
  }, 3000 ) ;
}
</script>
</body>
<script>
</script>
</html>